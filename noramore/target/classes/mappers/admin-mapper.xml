<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin">

	<resultMap type="Flow" id="resultFlow">
		<result property="enrollYesterday" column="enroll_Yesterday"/>
		<result property="enrollToday" column="enroll_Today"/>
		<result property="withdrawalYesterday" column="withdrawal_Yesterday"/>
		<result property="withdrawalToday" column="withdrawal_Today"/>
	</resultMap>
	
	<resultMap type="BoardManage" id="resultManage">
		<result property="boardRef" column="board_ref" />
		<result property="categoryId" column="category_Id" />
		<result property="categoryName" column="category_name" />
		<result property="boardId" column="board_Id" />
		<result property="title" column="title" />
		<result property="memberID" column="member_ID" />
		<result property="reportCount" column="report_Count" />
		<result property="readCount" column="read_Count" />
		<result property="registDate" column="regist_Date" />
	</resultMap>

	<select id="selectEWFlowCount" resultMap="resultFlow">
		select (select count(*)
				from member
				where to_char(regist_date, 'YYYY-MM-DD') = to_char(sysdate - 1, 'YYYY-MM-DD')
				and resign = 'N'
				and admin_yn = 'N') as enroll_Yesterday ,
				(select count(*)
				from member
				where to_char(regist_date, 'YYYY-MM-DD') = to_char(sysdate, 'YYYY-MM-DD')
				and resign = 'N'
				and admin_yn = 'N')  as enroll_Today,
				(select count(*)
				from member
				where to_char(regist_date, 'YYYY-MM-DD') = to_char(sysdate - 1, 'YYYY-MM-DD')
				and resign = 'Y'
				and admin_yn = 'N')  as withdrawal_Yesterday, 
				(select count(*)
				from member
				where to_char(regist_date, 'YYYY-MM-DD') = to_char(sysdate, 'YYYY-MM-DD')
				and resign = 'Y'
				and admin_yn = 'N')  as withdrawal_Today
		from dual
	</select>
	
	<select id="selectReportedListCount" resultType="_int">
		select count(*)
		from ( (select (select table_name
				from user_tables
				where table_name = 'RECR_BOARD') as borad_ref, category_name, board_id, title, member_ID, report_Count, read_Count, a.regist_Date
				from recr_board a
				join category b using (category_id)
				where report_count > 0)
				union
				(select (select table_name
				from user_tables
				where table_name = 'FREE_BOARD') as borad_ref, category_name, board_id, title, member_ID, report_Count, read_Count, a.regist_Date
				from free_board a
				join category b using (category_id)
				where report_count > 0))
	</select>
	
	<select id="selectReportedList" parameterType="Paging" resultMap="resultManage">
		select *
		from (select rownum rnum, borad_ref, category_id, category_name, board_id, title, member_ID, report_Count, read_Count, regist_Date
				from (select (select table_name
						from user_tables
						where table_name = 'RECR_BOARD') as borad_ref, category_id, category_name, board_id, title, member_ID, report_Count, read_Count, a.regist_Date
						from recr_board a
						join category b using (category_id)
						where report_count > 0
						union
						select (select table_name
						from user_tables
						where table_name = 'FREE_BOARD') as borad_ref, category_id, category_name, board_id, title, member_ID, report_Count, read_Count, a.regist_Date
						from recr_board a
						join category b using (category_id)
						where report_count > 0
						order by regist_Date desc))
		where rnum between #{ startRow } and #{ endRow }
	</select>
</mapper>
