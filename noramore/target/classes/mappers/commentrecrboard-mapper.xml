<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="commentrecrboard">
	<resultMap id="CommentResultMap" type="CommentRecrBoard">
	    <id column="COMMENT_ID" property="commentId"/>
	    <result column="BOARD_ID" property="boardId"/>
	    <result column="REF_COMMENT_ID" property="refCommentId"/>
	    <result column="MEMBER_ID" property="memberId"/>
	    <result column="CONTEXT" property="context"/>
	    <result column="REPORT_COUNT" property="reportCount"/>
	    <result column="COUNT_SUB_COMMENT" property="countSubComment"/>
	    <result column="REGIST_DATE" property="registDate"/>
	    <result column="LAST_UPDATE_DATE" property="lastUpdateDate"/>
	</resultMap>
	
	<insert id="insertRecrComment" parameterType="CommentRecrBoard">
		INSERT INTO COMM_RECR (BOARD_ID, COMMENT_ID, REF_COMMENT_ID, MEMBER_ID, CONTEXT, REPORT_COUNT, COUNT_SUB_COMMENT, REGIST_DATE, LAST_UPDATE_DATE)
    	VALUES (#{boardId}, (select max(COMMENT_ID) + 1 from COMM_RECR), #{refCommentId}, #{memberId}, #{context}, #{reportCount}, #{countSubComment}, SYSDATE, SYSDATE)
	</insert>

	<select id="selectRecrComment" parameterType="_int" resultMap="CommentResultMap">
		select * from comm_recr 
		where board_id = #{boardId} 
		and REF_COMMENT_ID = 0
	</select>
	
	<update id="upcountcocoment" parameterType="CommentRecrBoard">
		UPDATE COMM_RECR 
		SET COUNT_SUB_COMMENT = COUNT_SUB_COMMENT + 1 
		where BOARD_ID = #{boardId}
		and COMMENT_ID = #{refCommentId} 
	</update>
</mapper>
